import{E as W,_ as A,F as J,G as L,H as k,I as G,J as V,K as _,M as D,N as q,O as H,P as Q,S as Y,x as b,Q as z,R as X}from"./index-6a2cbdd1.js";var Z=function(i){W(u,i);function u(n,t){var e;return e=i.call(this)||this,e.client=n,e.options=t,e.trackedProps=[],e.selectError=null,e.bindMethods(),e.setOptions(t),e}var r=u.prototype;return r.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},r.onSubscribe=function(){this.listeners.length===1&&(this.currentQuery.addObserver(this),M(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},r.onUnsubscribe=function(){this.listeners.length||this.destroy()},r.shouldFetchOnReconnect=function(){return E(this.currentQuery,this.options,this.options.refetchOnReconnect)},r.shouldFetchOnWindowFocus=function(){return E(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},r.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},r.setOptions=function(t,e){var a=this.options,s=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(t),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=a.queryKey),this.updateQuery();var c=this.hasListeners();c&&B(this.currentQuery,s,this.options,a)&&this.executeFetch(),this.updateResult(e),c&&(this.currentQuery!==s||this.options.enabled!==a.enabled||this.options.staleTime!==a.staleTime)&&this.updateStaleTimeout();var o=this.computeRefetchInterval();c&&(this.currentQuery!==s||this.options.enabled!==a.enabled||o!==this.currentRefetchInterval)&&this.updateRefetchInterval(o)},r.getOptimisticResult=function(t){var e=this.client.defaultQueryObserverOptions(t),a=this.client.getQueryCache().build(this.client,e);return this.createResult(a,e)},r.getCurrentResult=function(){return this.currentResult},r.trackResult=function(t,e){var a=this,s={},c=function(h){a.trackedProps.includes(h)||a.trackedProps.push(h)};return Object.keys(t).forEach(function(o){Object.defineProperty(s,o,{configurable:!1,enumerable:!0,get:function(){return c(o),t[o]}})}),(e.useErrorBoundary||e.suspense)&&c("error"),s},r.getNextResult=function(t){var e=this;return new Promise(function(a,s){var c=e.subscribe(function(o){o.isFetching||(c(),o.isError&&(t!=null&&t.throwOnError)?s(o.error):a(o))})})},r.getCurrentQuery=function(){return this.currentQuery},r.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},r.refetch=function(t){return this.fetch(A({},t,{meta:{refetchPage:t==null?void 0:t.refetchPage}}))},r.fetchOptimistic=function(t){var e=this,a=this.client.defaultQueryObserverOptions(t),s=this.client.getQueryCache().build(this.client,a);return s.fetch().then(function(){return e.createResult(s,a)})},r.fetch=function(t){var e=this;return this.executeFetch(t).then(function(){return e.updateResult(),e.currentResult})},r.executeFetch=function(t){this.updateQuery();var e=this.currentQuery.fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(J)),e},r.updateStaleTimeout=function(){var t=this;if(this.clearStaleTimeout(),!(L||this.currentResult.isStale||!k(this.options.staleTime))){var e=G(this.currentResult.dataUpdatedAt,this.options.staleTime),a=e+1;this.staleTimeoutId=setTimeout(function(){t.currentResult.isStale||t.updateResult()},a)}},r.computeRefetchInterval=function(){var t;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(t=this.options.refetchInterval)!=null?t:!1},r.updateRefetchInterval=function(t){var e=this;this.clearRefetchInterval(),this.currentRefetchInterval=t,!(L||this.options.enabled===!1||!k(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(function(){(e.options.refetchIntervalInBackground||V.isFocused())&&e.executeFetch()},this.currentRefetchInterval))},r.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},r.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},r.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},r.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},r.createResult=function(t,e){var a=this.currentQuery,s=this.options,c=this.currentResult,o=this.currentResultState,h=this.currentResultOptions,d=t!==a,p=d?t.state:this.currentQueryInitialState,R=d?this.currentResult:this.previousQueryResult,l=t.state,m=l.dataUpdatedAt,U=l.error,w=l.errorUpdatedAt,S=l.isFetching,f=l.status,F=!1,P=!1,v;if(e.optimisticResults){var x=this.hasListeners(),N=!x&&M(t,e),$=x&&B(t,a,e,s);(N||$)&&(S=!0,m||(f="loading"))}if(e.keepPreviousData&&!l.dataUpdateCount&&(R!=null&&R.isSuccess)&&f!=="error")v=R.data,m=R.dataUpdatedAt,f=R.status,F=!0;else if(e.select&&typeof l.data<"u")if(c&&l.data===(o==null?void 0:o.data)&&e.select===this.selectFn)v=this.selectResult;else try{this.selectFn=e.select,v=e.select(l.data),e.structuralSharing!==!1&&(v=_(c==null?void 0:c.data,v)),this.selectResult=v,this.selectError=null}catch(g){D().error(g),this.selectError=g}else v=l.data;if(typeof e.placeholderData<"u"&&typeof v>"u"&&(f==="loading"||f==="idle")){var y;if(c!=null&&c.isPlaceholderData&&e.placeholderData===(h==null?void 0:h.placeholderData))y=c.data;else if(y=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof y<"u")try{y=e.select(y),e.structuralSharing!==!1&&(y=_(c==null?void 0:c.data,y)),this.selectError=null}catch(g){D().error(g),this.selectError=g}typeof y<"u"&&(f="success",v=y,P=!0)}this.selectError&&(U=this.selectError,v=this.selectResult,w=Date.now(),f="error");var K={status:f,isLoading:f==="loading",isSuccess:f==="success",isError:f==="error",isIdle:f==="idle",data:v,dataUpdatedAt:m,error:U,errorUpdatedAt:w,failureCount:l.fetchFailureCount,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>p.dataUpdateCount||l.errorUpdateCount>p.errorUpdateCount,isFetching:S,isRefetching:S&&f!=="loading",isLoadingError:f==="error"&&l.dataUpdatedAt===0,isPlaceholderData:P,isPreviousData:F,isRefetchError:f==="error"&&l.dataUpdatedAt!==0,isStale:I(t,e),refetch:this.refetch,remove:this.remove};return K},r.shouldNotifyListeners=function(t,e){if(!e)return!0;var a=this.options,s=a.notifyOnChangeProps,c=a.notifyOnChangePropsExclusions;if(!s&&!c||s==="tracked"&&!this.trackedProps.length)return!0;var o=s==="tracked"?this.trackedProps:s;return Object.keys(t).some(function(h){var d=h,p=t[d]!==e[d],R=o==null?void 0:o.some(function(m){return m===h}),l=c==null?void 0:c.some(function(m){return m===h});return p&&!l&&(!o||R)})},r.updateResult=function(t){var e=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!q(this.currentResult,e)){var a={cache:!0};(t==null?void 0:t.listeners)!==!1&&this.shouldNotifyListeners(this.currentResult,e)&&(a.listeners=!0),this.notify(A({},a,t))}},r.updateQuery=function(){var t=this.client.getQueryCache().build(this.client,this.options);if(t!==this.currentQuery){var e=this.currentQuery;this.currentQuery=t,this.currentQueryInitialState=t.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))}},r.onQueryUpdate=function(t){var e={};t.type==="success"?e.onSuccess=!0:t.type==="error"&&!H(t.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()},r.notify=function(t){var e=this;Q.batch(function(){t.onSuccess?(e.options.onSuccess==null||e.options.onSuccess(e.currentResult.data),e.options.onSettled==null||e.options.onSettled(e.currentResult.data,null)):t.onError&&(e.options.onError==null||e.options.onError(e.currentResult.error),e.options.onSettled==null||e.options.onSettled(void 0,e.currentResult.error)),t.listeners&&e.listeners.forEach(function(a){a(e.currentResult)}),t.cache&&e.client.getQueryCache().notify({query:e.currentQuery,type:"observerResultsUpdated"})})},u}(Y);function ee(i,u){return u.enabled!==!1&&!i.state.dataUpdatedAt&&!(i.state.status==="error"&&u.retryOnMount===!1)}function M(i,u){return ee(i,u)||i.state.dataUpdatedAt>0&&E(i,u,u.refetchOnMount)}function E(i,u,r){if(u.enabled!==!1){var n=typeof r=="function"?r(i):r;return n==="always"||n!==!1&&I(i,u)}return!1}function B(i,u,r,n){return r.enabled!==!1&&(i!==u||n.enabled===!1)&&(!r.suspense||i.state.status!=="error")&&I(i,r)}function I(i,u){return i.isStaleByTime(u.staleTime)}function te(){var i=!1;return{clearReset:function(){i=!1},reset:function(){i=!0},isReset:function(){return i}}}var re=b.createContext(te()),se=function(){return b.useContext(re)};function ne(i,u,r){return typeof u=="function"?u.apply(void 0,r):typeof u=="boolean"?u:!!i}function ie(i,u){var r=b.useRef(!1),n=b.useState(0),t=n[1],e=z(),a=se(),s=e.defaultQueryObserverOptions(i);s.optimisticResults=!0,s.onError&&(s.onError=Q.batchCalls(s.onError)),s.onSuccess&&(s.onSuccess=Q.batchCalls(s.onSuccess)),s.onSettled&&(s.onSettled=Q.batchCalls(s.onSettled)),s.suspense&&(typeof s.staleTime!="number"&&(s.staleTime=1e3),s.cacheTime===0&&(s.cacheTime=1)),(s.suspense||s.useErrorBoundary)&&(a.isReset()||(s.retryOnMount=!1));var c=b.useState(function(){return new u(e,s)}),o=c[0],h=o.getOptimisticResult(s);if(b.useEffect(function(){r.current=!0,a.clearReset();var d=o.subscribe(Q.batchCalls(function(){r.current&&t(function(p){return p+1})}));return o.updateResult(),function(){r.current=!1,d()}},[a,o]),b.useEffect(function(){o.setOptions(s,{listeners:!1})},[s,o]),s.suspense&&h.isLoading)throw o.fetchOptimistic(s).then(function(d){var p=d.data;s.onSuccess==null||s.onSuccess(p),s.onSettled==null||s.onSettled(p,null)}).catch(function(d){a.clearReset(),s.onError==null||s.onError(d),s.onSettled==null||s.onSettled(void 0,d)});if(h.isError&&!a.isReset()&&!h.isFetching&&ne(s.suspense,s.useErrorBoundary,[h.error,o.getCurrentQuery()]))throw h.error;return s.notifyOnChangeProps==="tracked"&&(h=o.trackResult(h,s)),h}function ce(i,u,r){var n=X(i,u,r);return ie(n,Z)}const C="https://api.jikan.moe";function le(){const i=new URL("/v4/genres/anime",C);return T(i)}function he(i){const u=new URL("/v4/anime",C);for(const r in i){const n=i[r];n&&u.searchParams.set(r,String(n))}return T(u)}function fe({id:i}){const u=new URL(`/v4/anime/${i}`,C);return T(u)}const ue=1e3;let j=0,O=Promise.resolve();function T(i){return O=O.then(()=>{const u=Date.now(),r=j+ue;if(u<r)return new Promise(n=>{setTimeout(n,r-u)})}).then(()=>{const u=Date.now();return fetch(i).then(r=>{const n=Date.now();if(n-u<20||(j=n),r.status>=400)throw new Error(r.statusText);return r.json()}).then(r=>{if(ae(r))throw new Error(r.error);return r})}),O}function ae(i){return typeof i=="object"&&typeof i.status=="number"&&typeof i.type=="string"&&typeof i.error=="string"&&typeof i.messages=="object"}export{he as a,fe as b,le as g,ce as u};
